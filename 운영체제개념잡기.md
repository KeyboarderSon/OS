## 운영체제 개념 잡기

컴퓨터를 제일 처음 켰을 때 실행되는 프로그램.  
ex) 윈도우, Mac os, ios, 리눅스, 유닉스 등  

이러한 운영체제는 어떤 동작을 수행할까?  
운영체제는 하드웨어(CPU, RAM, GPU, 하드디스크, SSD 등)를 사용해서 원하는 프로그램을 실행시켜주는 역할이다.

중개자 역할을 수행한다. 운영체제의 목적은 컴퓨터 하드웨어를 효율적으로 관리하여 쉽고 편리하게 수행할 수 있도록 한다.


### 컴퓨터 시스템 구성 요소

밑단부터,
* 하드웨어
* 운영체제
* 응용프로그램 - 워드프로세서, 게임, 웹 브라우저 ...
* 사용자

application이 운영체제 위에서 돌아가기 때문에 윈도우용, 맥 용이 따로 있는 것이다. CPU나 GPU 같은 하드웨어 자원을 이용해 게임이 끊김없이 돌아가도록 하는 것이 운영체제의 주 역할이다.


커널 + 시스템 프로그램을 합쳐서 운영체제라고 한다.
시스템 프로그램이란 컴퓨터를 사용하기 위해 꼭 존재해야하는 프로그램, 운영체제를 깔면 필수적으로 깔리는 프로그램
ex) 윈도우 탐색기 


### 운영체제의 역할

* 추상화 : 컴퓨터 시스템에서는 중요한 부분을 통합하여 하나로 만듦  
  각 제조사의 복잡한 하드웨어를 개념적으로 추상화하는 역할을 함
* Sharing : 자원 공유 방법
  * time multiplexing  
    컴퓨터 한 대를 동시에 사용하지만 한 사람이 온전히 사용하는 것처럼 느끼게끔.
    클라우드 게임을 이용할 때 자신의 pc에서 게임을 하는 것 같은.
  * space multiplexing  
    특정 프로세스에서 사용하고 있는 하드웨어 자원을 다른 프로세서에서 요청해서 필요로 하면 공유해줌.  
두 Sharing 모두 한정된 하드웨어 자원에서 프로세서에 효율적으로 사용하기 위한 방법이다.
* protection : 허가 받지 않은 사용자는 들어올 수 없도록 막아줌 
* fairness : 어떤 프로세스가 특정 자원을 계속 점유 하는 것을 막아줌 
* performance : 운영체제는 최고의 성능을 우선시하여 자원을 관리


### System Software Layer

* 사용자프로그램
* 미들웨어  
  사용자프로그램과 운영체제 사이 중개자 역할. 
  java virtual machine가 대표적. 운영체제와 상관 없이 동일한 언어와 패키지명을 사용하여 다른 운영체제에서도 실행되게끔 하는 소프트웨어
* 시스템프로그램
  소프트웨어 개발할 수 있는 환경 제공(컴파일러, 로더, 라이브러리)
* 운영체제
* Computer System Architecture(하드웨어)


### System software layer의 제일 하단부 : 컴퓨터 시스템 구조(Computer System Architecture)

하드웨어를 나타내는 구조  
컴퓨터 하드웨어에는 cpu, 메모리, SSD, 하드디스크, 그래픽카드 등이 존재한다. 

입출력 기기는 모두 **controller**로 제어를 받는다. controller는 I/O를 제어하고 결괏값을 System bus를 통해 메모리에 저장하며 cpu가 프로세스를 처리한다.  

Controller 사용 이유는 디스크, 마우스, 키보드, 프린터, 모니터와 같은 경우는 CPU에 비해 속도가 상당히 느리다. 연산 속도 빠른 cpu가 이들의 처리가 완료될 때까지 기다려야만 하는데 각 하드웨어 당 컨트롤러를 두어 결괏값을 동기화하는 방식으로 구성.


* Register
  cpu 안에 있는 저장공간  
  cpu가 연산을 하고 데이터 처리를 할 때 필요
  * Program Counter : 다음에 실행될 명령어의 주소를 가리킴
  * Instruction Register : 명령어를 해독하기 위해 잠시 보관하는 레지스터
  * **PSW** : cpu가 현재 어디를 처리하고 있고 어떤 상황인지 나타냄
  * general purpose registers : 데이터 기억 혹은 일반적인 연산 처리

메모리에 데이터가 저장이 되어있다 하더라고 cpu로 데이터를 가져와서 작업을 해야 한다.

* instruction set Architecture 
    * RISC : CPU의 명령어 개수를 줄여 하드웨어 구조를 더 간단하게 하자. 복잡한 명령어는 소프트웨어로 하자.
    * CISC : 복잡한 명령어 집합을 갖는 cpu 시스템 아키텍처
* Pipelining
특수한 작업을 병렬 처리하도록
작업 동시 수행에 관하여
  *  Fetch, Decode, Execute, Write Back ...
  Fetch : 명령어를 실행하기 위해서는 메모리에 있는 명령어를 instruction register에 갖다놔야 함  
  store? load? 해석하는 것이 Decode  
  여러개의 명령어를 동시에 작업 수행하는 것과 같이 보임.

* ILP(명령어를 동시에 실행시키자)
    * superscalar  
      cpu가 실행시키면서 동적으로 실행
    * VLIW   
      컴파일러에 의해서 동시 실행 가능한 것과 아닌 것을 미리 구분

## 메모리

하드디스크에서 데이터를 직접적으로 불러오려 하면 디스크가 CPU 속도에 맞추기 어려워 이에 대한 보조가 메모리이다.

* 메인메모리
    * havard arcitecture : instruction 캐시와 data 캐시를 따로 두면 적중률이 더 높아진다.
    * SRAM vs DRAM
    static 고정적. DRAM보다 성능이 좋음. refresh가 필요 없기 때문에. CPU의 캐시메모리에 적합. 캐시는 미래의 요청에 대비하여 데이터를 임시로 저장하는 영역.  
    Dynamic 동적. refresh를 주기적으로 해줘야 하고 이래야 내용이 유지됨. 대용량에 적합
* Secondary Storage
  ex) 하드디스크, ssd, ...


> 저장소에 관한 구조를 계층적으로 보자.

|메모리 계층 구조|
|-----------|
|CPU의 레지스터|
|캐시, SRAM으로 구성|
|메인메모리, DRAM으로 구성|
|Secondary storage - ssd, 하드디스크|



**캐시?**  
캐시메모리에는 자주 쓰는 데이터를 저장해서 캐시에서 바로 읽어 처리하기 위함이다. 



> 캐시에서 데이터를 쓸 때에는?

* Write through  
  캐시와 메인 동시에 write. 데이터 일관성 유지 측면에서 좋다.
* Write back  
  캐시메모리에만 write 후 한꺼번에 메인메모리에 수정. 성능상 좋다.


## I/O Device
키보드, 마우스, 모니터, 스피커, 마이크 등  
I/O 장치를 사용하게 되면 cpu가 I/O 장치에게 명령하여 I/O 장치가 다 수행했다고 알려주기도,  
반대로 외부에서 작업이 들어오면 io가 cpu에게 알려준다. 

이벤트에 대해 주고받는 것을 **인터럽트**라고 한다.


### 인터럽트의 방식

* polling - 지속적으로 시스템에게 물어보는 방식.  
  자꾸 I/O 디바이스에게 수행했냐고 수시로 물어보는 것이다. 비효율적. 오버헤드가 크다.
* hardware interrupt - 일반적으로 사용되는 방식.  
  I/O 장치에서 다 수행했다고 CPU에게 역으로 알려주는 방식




### io 기기에서 인터럽트가 발생하면 어떻게 동작할까?

> 1) cpu에서 수행하던 작업을 멈추고 저장한다.
> 2) cpu에서 사용하던 register 집합을 메모리에 저장한다.
> 3) 해당 인터럽트 발생했던 곳으로 점프한다.
> 4) 코드 수행한 뒤 저장해놓았던 레지스터를 가져와 하던 작업을 계속한다.

키보드를 칠 때마다 I/O기기가 cpu에게 이런 데이터를 받았다라고 인터럽트를 걸어 알려주는 거라 보면 된다.

* 인터럽트  
  io장치가 cpu에게 이벤트가 발생했음을 알려주는 것이다.
* exception  
  잘못된 명령을 받아 cpu가 실행할 수 없어 cpu가 운영체제에게 도움을 요청하고 자기 자신에게 인터럽트를 거는 것. 5/0 같은 경우 수행할 수 없으니 이러한 경우 운영체제가 해결해준다.
  * trap  
    어플리케이션이 운영체제에게 서비스를 요청해서 프로그램이 돌아가는 형태.  
    hello world 코드를 짰다면 운영체제에서 이 문자를 모니터로 내보내줘야 하는데 이때 사용되는 것이 trap이다. 


### I/O장치가 데이터를 어떻게 올리나?

cpu가 하드디스크에서 1G 파일을 불러오라 한다면 cpu의 레지스터는 공간이 너무 작아 다 불러올 수 없을 것이다. 결국 메모리에 올려놔야 하는데 하드디스크에서 메인메모리에 직접적 접근을 하여 데이터를 바로 올려놓는 것이 DMA(Direct Memory Access)이다.